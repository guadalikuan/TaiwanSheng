//! # TOT 常量定义模块
//! 
//! 本模块定义了TOT代币系统的所有常量，包括代币参数、池子分配、税率参数、
//! 时间常量等。这些常量构成了TOT的"数学宇宙"，是系统运行的基础。
//! 
//! ## 常量分类
//! 
//! 1. **代币基础参数**: 名称、符号、精度、总供应量
//! 2. **池子分配**: 五大池子的代币分配数量
//! 3. **时间常量**: 解锁时间、释放周期等
//! 4. **税率参数**: 动态税收模型的所有参数
//! 5. **PDA种子**: 用于派生程序派生地址的种子
//! 6. **账户大小**: 各状态账户所需的空间大小
//! 7. **限制常量**: 各种业务限制的最大值
//! 
//! ============================================
// 文件: programs/tot-token/src/constants.rs
// 常量定义 - TOT 数学宇宙
// ============================================

use anchor_lang::prelude::*;

// ============================================
// 代币基础参数
// ============================================

/// 代币名称
/// 在链上元数据中显示的名称
pub const TOKEN_NAME: &str = "TaiOneToken";

/// 代币符号
/// 在交易所和钱包中显示的符号，通常为3-5个字符
pub const TOKEN_SYMBOL: &str = "TOT";

/// 代币精度（小数位数）
/// Solana代币使用u64存储，精度决定了最小单位
/// 例如：精度为9时，1 TOT = 1,000,000,000 基础单位
pub const TOKEN_DECIMALS: u8 = 9;

/// 总供应量
/// 
/// 数值: 202,700,000,000 (202.7亿)
/// 
/// 数学含义: 对应2027年，这是TOT的终极时间锚点
/// 
/// 存储说明: 实际存储值需要乘以 10^9 (decimals)
/// 计算公式: 202.7B * 10^9 = 202,700,000,000,000,000,000
/// 
/// 重要特性:
/// - 一次性铸造，永不增发
/// - 可以通过销毁减少供应量
/// - 总供应量 = 五大池子分配之和
pub const TOTAL_SUPPLY: u64 = 202_700_000_000_000_000_000;

/// 五大池子分配模块
/// 
/// 定义了TOT代币的五大池子分配方案，每个池子都有特定的用途和释放机制。
/// 所有数值单位为基础单位（已乘以10^9），总和等于TOTAL_SUPPLY。
pub mod allocation {
    use super::*;
    
    /// 胜利日基金池
    /// 
    /// 数量: 20.27B (占总供应量的10%)
    /// 数学含义: 20.27对应2027年，象征统一目标
    /// 
    /// 用途:
    /// - 核心团队和开发者的奖励
    /// - 战略储备资金
    /// - 项目运营资金
    /// 
    /// 锁仓规则:
    /// - 完全锁定至2027年1月1日 00:00:00 UTC
    /// - 在此之前无法提取任何代币
    /// - 这是"破釜沉舟"机制，确保团队与项目共进退
    /// 
    /// 释放机制: 时间锁，到期后一次性解锁
    pub const VICTORY_FUND: u64 = 20_270_000_000_000_000_000;
    
    /// 历史重铸池（初始流动性池）
    /// 
    /// 数量: 19.49B (占总供应量的9.6%)
    /// 数学含义: 19.49对应1949年，象征两岸分治的历史起点
    /// 
    /// 用途:
    /// - 初始流动性提供（与SOL/USDC配对）
    /// - 在Raydium等DEX创建交易池
    /// 
    /// 锁仓规则:
    /// - 立即可用，无时间锁
    /// - LP Token将永久锁定（打入黑洞地址）
    /// - 寓意：1949年的历史不可逆转，TOT的底池也永远不可撤资
    /// 
    /// 释放机制: 立即释放，用于创建流动性池
    pub const HISTORY_LP: u64 = 19_490_000_000_000_000_000;
    
    /// 认知作战池（社区激励池）
    /// 
    /// 数量: 14.50B (占总供应量的7.15%)
    /// 数学含义: 14.50对应"1450"，台湾网军的代称，寓意"以毒攻毒"
    /// 
    /// 用途:
    /// - 社区激励和空投
    /// - 悬赏任务奖励
    /// - 推广和营销费用
    /// - 雇佣KOL、Line群主等
    /// 
    /// 锁仓规则:
    /// - 无时间锁，但采用线性释放
    /// 
    /// 释放机制:
    /// - 365天线性释放
    /// - 每天释放约0.1%作为当天的"作战经费"
    /// - 确保资金持续投入社区建设
    pub const CYBER_ARMY: u64 = 14_500_000_000_000_000_000;
    
    /// 外资统战池（机构投资者池）
    /// 
    /// 数量: 7.04B (占总供应量的3.47%)
    /// 数学含义: 7.04对应7月4日（美国独立日），象征西方资本
    /// 
    /// 用途:
    /// - QFII（合格境外机构投资者）分配
    /// - 机构投资者（如西城四合院大佬）的份额
    /// - 交易所上币费用
    /// - 置换美元资产，对接华尔街和西方资本
    /// 
    /// 锁仓规则:
    /// - 无时间锁，但需要多签控制
    /// 
    /// 释放机制:
    /// - 需要3-of-5多签才能释放
    /// - 确保机构资金的安全和合规
    /// - 寓意："挟洋自重"的逆向操作——让洋人不得不买我们的账
    pub const GLOBAL_ALLIANCE: u64 = 7_040_000_000_000_000_000;
    
    /// 资产锚定池（RWA储备池）
    /// 
    /// 数量: 141.40B (占总供应量的69.76%)
    /// 数学含义: 141.40象征14亿人民与1.4万亿的房地产库存
    /// 
    /// 用途:
    /// - RWA（现实世界资产）锚定储备
    /// - 代表对2027年后大中华区指定资产的优先兑换权
    /// - 包括：1000万套内陆战备安全屋、未确权祖产、基建股权等
    /// 
    /// 锁仓规则:
    /// - 非流通状态（Non-Circulating）
    /// - 无时间锁，但采用"单向阀"机制
    /// 
    /// 释放机制:
    /// - "单向阀"机制：只有当有人通过以下方式时才会释放：
    ///   * "颜面换币"（身份验证）
    ///   * "地契换币"（资产确权）
    ///   * "新台币置换"（法币兑换）
    /// - 它不是币，它是未来的房产证
    /// - 通过RWA智能合约验证后才会解锁对应数量的TOT
    pub const ASSET_ANCHOR: u64 = 141_400_000_000_000_000_000;
}

/// 时间常量模块
/// 
/// 定义了系统中使用的时间相关常量，包括解锁时间、释放周期等。
pub mod time {
    use super::*;
    
    /// 胜利日解锁时间
    /// 
    /// 数值: 2027年1月1日 00:00:00 UTC 的 Unix 时间戳
    /// 计算: 2027-01-01 00:00:00 UTC = 1798761600
    /// 
    /// 用途:
    /// - 胜利日基金池的解锁时间
    /// - 在此之前，胜利日基金完全锁定，无法提取
    /// 
    /// 意义:
    /// - 这是TOT的终极时间锚点
    /// - 象征统一目标的时间节点
    /// - 确保团队与项目共进退
    pub const VICTORY_UNLOCK_TIME: i64 = 1798761600;
    
    /// 线性释放周期
    /// 
    /// 数值: 365天（以秒为单位）
    /// 计算: 365 * 24 * 60 * 60 = 31,536,000 秒
    /// 
    /// 用途:
    /// - 认知作战池的线性释放周期
    /// - 用于计算每天应释放的代币数量
    /// 
    /// 释放计算:
    /// - 每天释放量 = 总分配量 / 365
    /// - 已释放量 = (当前时间 - 开始时间) / 周期 * 总分配量
    pub const LINEAR_VESTING_PERIOD: i64 = 365 * 24 * 60 * 60;
    
    /// 每日秒数
    /// 
    /// 数值: 86400 秒（24小时）
    /// 
    /// 用途:
    /// - 计算持有天数的基数
    /// - 时间单位转换
    /// - 持有时间折扣计算
    pub const SECONDS_PER_DAY: i64 = 86400;
}

/// 动态税收模型参数模块
/// 
/// 定义了TOT动态重力场税收模型（TOT-DGTM）的所有参数。
/// 这些参数控制着税率计算的核心逻辑。
pub mod tax {
    use super::*;
    
    /// 基础税率
    /// 
    /// 数值: 2% (以 basis points 表示, 200 = 2%)
    /// 
    /// 说明:
    /// - 这是所有转账的基础税率，不考虑任何折扣和惩罚
    /// - 用于公式: Tax = Base + 惩罚项 - 折扣项
    /// - 这是给国库（基金会）的基本供奉，所有转账都需要支付
    /// 
    /// 用途: 税率计算公式的基础值
    pub const BASE_TAX_BPS: u16 = 200;
    
    /// 最大税率
    /// 
    /// 数值: 99% (9900 basis points)
    /// 
    /// 说明:
    /// - 这是系统允许的最大税率上限
    /// - 无论计算出的税率多高，都不会超过此值
    /// - 用于防止极端情况下的税率异常
    /// 
    /// 用途: 税率计算的保护上限
    pub const MAX_TAX_BPS: u16 = 9900;
    
    /// 惩罚系数 α
    /// 
    /// 数值: 5 (放大100倍存储为500)
    /// 
    /// 说明:
    /// - 用于公式中的大额交易惩罚项: (P_impact / L) × α
    /// - α值越大，大额交易的惩罚越重
    /// - 当交易规模占池子深度比例较大时，税率会急剧上升
    /// 
    /// 作用:
    /// - 防止大额抛售（砸盘）
    /// - 保护流动性池的稳定性
    /// - 实现"自动熔断式税收"
    /// 
    /// 示例:
    /// - 如果一笔交易占池子深度的10%，惩罚项 = 10% × 5 = 50%
    /// - 这意味着仅惩罚项就会增加50%的税率
    pub const ALPHA_COEFFICIENT: u64 = 500;
    
    /// 时间衰减指数 β
    /// 
    /// 数值: 0.5 (放大100倍存储为50)
    /// 
    /// 说明:
    /// - 用于公式中的持有时间折扣项: 1/(T_hold + 1)^β × γ
    /// - β值控制折扣的衰减速度
    /// - β = 0.5 表示平方根衰减，即折扣随持有时间平方根增长
    /// 
    /// 作用:
    /// - 奖励长期持有者
    /// - 惩罚短期投机者
    /// - 实现"时间熔炉"机制
    /// 
    /// 效果:
    /// - 持币时间越长，折扣越大
    /// - 但折扣的增长速度会逐渐放缓（平方根特性）
    pub const BETA_EXPONENT: u64 = 50;
    
    /// 忠诚度权重 γ
    /// 
    /// 数值: 20% (2000 basis points)
    /// 
    /// 说明:
    /// - 用于公式中的持有时间折扣项: 1/(T_hold + 1)^β × γ
    /// - γ值控制折扣的最大幅度
    /// - 即使持有时间无限长，折扣也不会超过γ值
    /// 
    /// 作用:
    /// - 设置持有时间折扣的上限
    /// - 确保基础税率不会被完全抵消
    /// 
    /// 效果:
    /// - 新用户（< 1天）: 折扣 = 1/1^0.5 × 20% = 20% 额外税
    /// - 长期持有（> 100天）: 折扣 ≈ 1/101^0.5 × 20% ≈ 2% 额外税
    /// - 超长期持有（> 1000天）: 折扣接近0，几乎免税
    pub const GAMMA_WEIGHT_BPS: u16 = 2000;
    
    /// 恐慌模式触发阈值
    /// 
    /// 数值: 0.5% 的池子深度 (50 basis points)
    /// 
    /// 说明:
    /// - 当单笔卖出交易占池子深度的比例超过此值时，触发恐慌模式
    /// - 恐慌模式下，税率会大幅提高，防止大规模抛售
    /// 
    /// 用途:
    /// - 保护流动性池免受大额抛售冲击
    /// - 实现"反脆弱机制"
    /// 
    /// 触发条件:
    /// - 卖出金额 / 池子深度 > 0.5%
    pub const PANIC_THRESHOLD_BPS: u16 = 50;
    
    /// 恐慌模式税率
    /// 
    /// 数值: 30% (3000 basis points)
    /// 
    /// 说明:
    /// - 当触发恐慌模式时，税率会直接设置为30%
    /// - 这是一个固定的高税率，用于阻止大规模抛售
    /// 
    /// 用途:
    /// - 紧急情况下的保护机制
    /// - 防止市场恐慌导致的流动性枯竭
    pub const PANIC_TAX_BPS: u16 = 3000;
    
    /// 流动性注入比例
    /// 
    /// 数值: 80% (8000 basis points)
    /// 
    /// 说明:
    /// - 收取的税收中，80%会自动注入流动性池
    /// - 这实现了"草船借箭"机制：抛售者的税收变成流动性
    /// 
    /// 效果:
    /// - 每次抛售都会增加池子深度
    /// - 即使代币数量不变，价格也会被动上涨
    /// - 实现"动态K值"的AMM机制
    pub const LP_INJECTION_RATIO_BPS: u16 = 8000;
    
    /// 国库比例
    /// 
    /// 数值: 20% (2000 basis points)
    /// 
    /// 说明:
    /// - 收取的税收中，20%进入国库
    /// - 用于项目运营、开发、营销等
    /// 
    /// 用途:
    /// - 项目可持续发展资金
    /// - 运营和维护费用
    pub const TREASURY_RATIO_BPS: u16 = 2000;
    
    /// 税收分配比例模块
    /// 
    /// 定义了税收的最终分配方案。税收会按照以下比例分配：
    pub mod distribution {
        use super::*;
        
        /// 销毁比例
        /// 
        /// 数值: 40% (4000 basis points)
        /// 
        /// 说明:
        /// - 40%的税收会被永久销毁
        /// - 实现通缩机制，减少总供应量
        /// - 长期持有者受益于代币稀缺性
        /// 
        /// 效果:
        /// - 每次交易都会减少总供应量
        /// - 随着时间推移，代币越来越稀缺
        /// - 提升代币的长期价值
        pub const TAX_TO_BURN_BPS: u16 = 4000;
        
        /// 流动性池注入比例
        /// 
        /// 数值: 30% (3000 basis points)
        /// 
        /// 说明:
        /// - 30%的税收会注入流动性池
        /// - 增加池子深度，提升价格稳定性
        /// - 实现"草船借箭"机制
        /// 
        /// 效果:
        /// - 每次交易都会增加池子深度
        /// - 即使代币数量不变，价格也会上涨
        /// - 形成正向循环：抛售越多，底价越高
        pub const TAX_TO_LIQUIDITY_BPS: u16 = 3000;
        
        /// 社区奖励比例
        /// 
        /// 数值: 20% (2000 basis points)
        /// 
        /// 说明:
        /// - 20%的税收用于社区奖励
        /// - 激励社区建设和推广
        /// - 回馈长期持有者
        /// 
        /// 用途:
        /// - 空投和奖励
        /// - 社区活动资金
        /// - 推广激励
        pub const TAX_TO_COMMUNITY_BPS: u16 = 2000;
        
        /// 营销费用比例
        /// 
        /// 数值: 10% (1000 basis points)
        /// 
        /// 说明:
        /// - 10%的税收用于营销和推广
        /// - 支持项目的市场推广活动
        /// 
        /// 用途:
        /// - 广告投放
        /// - KOL合作
        /// - 品牌建设
        pub const TAX_TO_MARKETING_BPS: u16 = 1000;
    }
    
    // 为了向后兼容，保留旧的导出名称
    pub use distribution::*;
}

/// PDA种子常量模块
/// 
/// 定义了用于派生程序派生地址（PDA）的种子字符串。
/// 这些种子用于创建确定性的账户地址，确保每次部署都能找到相同的账户。
pub mod seeds {
    use super::*;
    
    /// 全局配置账户种子
    /// 用于派生TotConfig账户的PDA地址
    pub const CONFIG_SEED: &[u8] = b"tot_config";
    
    /// 池子账户种子
    /// 用于派生PoolAccount账户的PDA地址
    /// 注意：实际使用时需要结合池子类型（u8）一起派生
    pub const POOL_SEED: &[u8] = b"tot_pool";
    
    /// 持有者账户种子
    /// 用于派生HolderAccount账户的PDA地址
    /// 注意：实际使用时需要结合持有者钱包地址一起派生
    pub const HOLDER_SEED: &[u8] = b"tot_holder";
    
    /// 国库账户种子
    /// 用于派生国库账户的PDA地址（如果使用PDA作为国库）
    pub const TREASURY_SEED: &[u8] = b"tot_treasury";
    
    /// Mint权限账户种子
    /// 用于派生Mint Authority的PDA地址（如果使用PDA作为Mint Authority）
    pub const MINT_AUTHORITY_SEED: &[u8] = b"tot_mint_auth";
    
    /// 税率配置账户种子
    /// 用于派生TaxConfig账户的PDA地址
    pub const TAX_CONFIG_SEED: &[u8] = b"tot_tax_config";
    
    /// Transfer Hook配置账户种子
    /// 用于派生HookConfig账户的PDA地址（在Transfer Hook程序中）
    pub const HOOK_CONFIG_SEED: &[u8] = b"hook_config";
}

/// 基点常量
/// 
/// 数值: 10000
/// 
/// 说明:
/// - 在金融系统中，1个基点（basis point）= 0.01% = 1/10000
/// - 10000个基点 = 100%
/// - 使用基点可以避免浮点数运算，提高精度
/// 
/// 用途:
/// - 税率计算: 税率 = 税率bps / BASIS_POINTS
/// - 百分比计算: 百分比 = 数值 * bps / BASIS_POINTS
/// 
/// 示例:
/// - 200 bps = 200 / 10000 = 2%
/// - 5000 bps = 5000 / 10000 = 50%
pub const BASIS_POINTS: u64 = 10000;

/// 账户大小常量模块
/// 
/// 定义了各个状态账户所需的空间大小（以字节为单位）。
/// 这些常量用于账户初始化时的空间分配。
/// 
/// 注意: Anchor会自动添加8字节的discriminator，所以实际账户大小 = 8 + 结构体大小
pub mod size {
    use super::*;
    
    /// 全局配置账户大小
    /// 
    /// 总大小: 8 + 32 + 32 + 32 + 32 + 1 + 8 + 8 + 8 + 8 + 1 + 128 = 286 字节
    /// 
    /// 字段说明:
    /// - 8: discriminator（Anchor自动添加）
    /// - 32: authority（管理员地址）
    /// - 32: mint（代币Mint地址）
    /// - 32: treasury（国库地址）
    /// - 32: liquidity_pool（流动性池地址）
    /// - 1: panic_mode（恐慌模式标志）
    /// - 8: initialized_at（初始化时间戳）
    /// - 8: total_minted（总铸造量）
    /// - 8: total_burned（总销毁量）
    /// - 8: total_tax_collected（总收税额）
    /// - 1: version（配置版本）
    /// - 128: reserved（预留空间，用于未来扩展）
    pub const CONFIG_SIZE: usize = 8 + // discriminator
        32 + // authority
        32 + // mint
        32 + // treasury
        32 + // liquidity_pool
        1 + // panic_mode
        8 + // initialized_at
        8 + // total_minted
        8 + // total_burned
        8 + // total_tax_collected
        1 + // version
        128; // reserved
    
    /// 池子账户大小
    /// 
    /// 总大小: 8 + 1 + 32 + 8 + 8 + 8 + 8 + 8 + 1 + 1 + 160 + 1 = 252 字节
    /// 
    /// 字段说明:
    /// - 8: discriminator
    /// - 1: pool_type（池子类型枚举）
    /// - 32: token_account（池子代币账户地址）
    /// - 8: initial_allocation（初始分配量）
    /// - 8: released_amount（已释放量）
    /// - 8: unlock_time（解锁时间戳）
    /// - 8: vesting_start（释放开始时间）
    /// - 8: vesting_period（释放周期）
    /// - 1: requires_multisig（是否需要多签）
    /// - 1: multisig_threshold（多签阈值）
    /// - 160: multisig_signers（5个多签签名者地址，32字节×5）
    /// - 1: bump（PDA bump seed）
    pub const POOL_SIZE: usize = 8 + // discriminator
        1 + // pool_type
        32 + // token_account
        8 + // initial_allocation
        8 + // released_amount
        8 + // unlock_time
        8 + // vesting_start
        8 + // vesting_period
        1 + // requires_multisig
        1 + // multisig_threshold
        (32 * 5) + // multisig_signers (5个地址)
        1; // bump
    
    /// 持有者账户大小
    /// 
    /// 总大小: 8 + 32 + 32 + 8 + 8 + 8 + 8 + 8 + 8 + 1 + 1 + 1 = 121 字节
    /// 
    /// 字段说明:
    /// - 8: discriminator
    /// - 32: owner（持有者钱包地址）
    /// - 32: token_account（持有者代币账户地址）
    /// - 8: first_hold_time（首次持有时间戳）
    /// - 8: last_transaction_time（最后交易时间戳）
    /// - 8: weighted_hold_days（加权持有天数）
    /// - 8: total_bought（累计买入量）
    /// - 8: total_sold（累计卖出量）
    /// - 8: total_tax_paid（累计缴税额）
    /// - 1: is_frozen（是否被冻结）
    /// - 1: freeze_reason（冻结原因代码）
    /// - 1: bump（PDA bump seed）
    pub const HOLDER_SIZE: usize = 8 + // discriminator
        32 + // owner
        32 + // token_account
        8 + // first_hold_time
        8 + // last_transaction_time
        8 + // weighted_hold_days
        8 + // total_bought
        8 + // total_sold
        8 + // total_tax_paid
        1 + // is_frozen
        1 + // freeze_reason
        1; // bump
}

/// 业务限制常量模块
/// 
/// 定义了系统中各种业务限制的最大值，用于防止资源滥用和确保系统安全。
pub mod limits {
    use super::*;
    
    /// 最大冻结原因长度
    /// 
    /// 数值: 100 字符
    /// 
    /// 说明:
    /// - 冻结账户时，原因字符串的最大长度
    /// - 超过此长度的原因会被拒绝
    /// 
    /// 用途:
    /// - 限制链上存储的数据量
    /// - 防止恶意输入
    pub const MAX_FREEZE_REASON_LEN: usize = 100;
    
    /// 最大免税地址数量
    /// 
    /// 数值: 50 个地址
    /// 
    /// 说明:
    /// - 免税地址列表的最大容量
    /// - 超过此数量后无法继续添加免税地址
    /// 
    /// 用途:
    /// - 限制免税地址的数量，防止滥用
    /// - 控制账户大小，节省存储空间
    /// 
    /// 典型用途:
    /// - 流动性池地址
    /// - DEX合约地址
    /// - 系统合约地址
    pub const MAX_TAX_EXEMPT_ADDRESSES: usize = 50;
    
    /// 最大税率层级数
    /// 
    /// 数值: 10 个层级
    /// 
    /// 说明:
    /// - 如果未来实现多层级税率系统，这是最大层级数
    /// - 当前版本使用动态计算，不使用固定层级
    /// 
    /// 用途:
    /// - 预留未来功能扩展
    /// - 限制配置复杂度
    pub const MAX_TAX_TIERS: usize = 10;
}
