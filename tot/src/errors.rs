//! # TOT 错误定义模块
//! 
//! 本模块定义了TOT代币系统中所有可能的错误类型。
//! 错误按照功能模块分类，每个错误都有明确的错误码和错误消息。
//! 
//! ## 错误分类
//! 
//! 1. **初始化错误** (6000-6009): 系统初始化相关的错误
//! 2. **池子错误** (6010-6019): 池子操作相关的错误
//! 3. **税率错误** (6020-6039): 税率计算和配置相关的错误
//! 4. **持有者错误** (6040-6059): 持有者账户管理相关的错误
//! 5. **转账错误** (6060-6079): 转账操作相关的错误
//! 6. **管理员错误** (6080-6099): 管理员操作相关的错误
//! 7. **数学错误** (6100-6109): 数学运算相关的错误
//! 8. **时间错误** (6110-6119): 时间相关验证的错误
//! 
//! ============================================
// 文件: src/errors.rs
// 错误定义
// ============================================

use anchor_lang::prelude::*;

/// TOT代币系统错误枚举
/// 
/// 所有错误都使用Anchor的error_code宏定义，会自动分配错误码。
/// 错误消息会显示在链上日志中，便于调试和审计。
#[error_code]
pub enum TotError {
    // ============================================
    // 初始化错误 (6000-6009)
    // ============================================
    
    /// 系统已初始化
    /// 
    /// 触发场景:
    /// - 尝试重复初始化代币系统
    /// - 尝试重复铸造代币到池子
    /// 
    /// 解决方案:
    /// - 检查系统是否已经初始化
    /// - 使用已存在的配置账户
    #[msg("Already initialized")]
    AlreadyInitialized,
    
    /// 无效的管理员权限
    /// 
    /// 触发场景:
    /// - 非管理员尝试执行管理员操作
    /// - 管理员地址不匹配
    /// 
    /// 解决方案:
    /// - 确认使用正确的管理员账户
    /// - 检查账户权限设置
    #[msg("Invalid authority")]
    InvalidAuthority,
    
    /// 无效的Mint地址
    /// 
    /// 触发场景:
    /// - Mint地址不匹配
    /// - Mint账户未正确初始化
    /// 
    /// 解决方案:
    /// - 确认使用正确的Mint地址
    /// - 检查Mint账户的初始化状态
    #[msg("Invalid mint")]
    InvalidMint,
    
    /// 无效的初始化参数
    /// 
    /// 触发场景:
    /// - 初始化参数不符合要求
    /// - 参数验证失败
    /// 
    /// 解决方案:
    /// - 检查初始化参数的有效性
    /// - 确认参数在允许的范围内
    #[msg("Invalid initialization parameters")]
    InvalidInitParams,

    // ============================================
    // 池子错误 (6010-6019)
    // ============================================
    
    /// 池子已初始化
    /// 
    /// 触发场景:
    /// - 尝试重复初始化同一个池子类型
    /// 
    /// 解决方案:
    /// - 使用已存在的池子账户
    /// - 检查池子是否已经初始化
    #[msg("Pool already initialized")]
    PoolAlreadyInitialized,
    
    /// 池子未初始化
    /// 
    /// 触发场景:
    /// - 尝试操作未初始化的池子
    /// - 池子账户不存在
    /// 
    /// 解决方案:
    /// - 先调用init_pool初始化池子
    /// - 确认池子账户已创建
    #[msg("Pool not initialized")]
    PoolNotInitialized,
    
    /// 无效的池子类型
    /// 
    /// 触发场景:
    /// - 传入的池子类型枚举值超出范围（> 4）
    /// - 池子类型不匹配
    /// 
    /// 解决方案:
    /// - 使用有效的池子类型枚举值（0-4）
    /// - 确认池子类型与账户匹配
    #[msg("Invalid pool type")]
    InvalidPoolType,
    
    /// 池子已锁定
    /// 
    /// 触发场景:
    /// - 尝试从锁定的池子中提取代币
    /// - 解锁时间未到
    /// 
    /// 解决方案:
    /// - 等待解锁时间到达
    /// - 检查池子的unlock_time字段
    #[msg("Pool is locked")]
    PoolLocked,
    
    /// 池子余额不足
    /// 
    /// 触发场景:
    /// - 尝试提取超过池子余额的代币数量
    /// - 池子中代币不足
    /// 
    /// 解决方案:
    /// - 检查池子余额
    /// - 减少提取数量
    #[msg("Insufficient pool balance")]
    InsufficientPoolBalance,
    
    /// 池子解锁时间未到
    /// 
    /// 触发场景:
    /// - 尝试在解锁时间之前提取代币
    /// - 当前时间 < unlock_time
    /// 
    /// 解决方案:
    /// - 等待解锁时间到达
    /// - 检查当前时间戳和unlock_time
    #[msg("Pool unlock time not reached")]
    PoolUnlockTimeNotReached,

    // ============================================
    // 税率错误 (6020-6039)
    // ============================================
    
    /// 无效的税率值
    /// 
    /// 触发场景:
    /// - 税率超过100% (basis points > 10000)
    /// - 税率为负数（在Rust中不会发生，但类型转换可能出错）
    /// 
    /// 解决方案:
    /// - 确保税率在0-10000 basis points范围内
    /// - 10000 basis points = 100%
    #[msg("Invalid tax rate - must be <= 10000 (100%)")]
    InvalidTaxRate,
    
    /// 税率超过最大允许值
    /// 
    /// 触发场景:
    /// - 尝试设置超过MAX_TAX_BPS (99%)的税率
    /// - 计算出的税率超过系统上限
    /// 
    /// 解决方案:
    /// - 税率不能超过9900 basis points (99%)
    /// - 系统会自动将税率限制在最大值
    #[msg("Tax rate exceeds maximum allowed")]
    TaxRateExceedsMaximum,
    
    /// 无效的税率层级配置
    /// 
    /// 触发场景:
    /// - 税率层级配置不符合要求
    /// - 层级参数无效
    /// 
    /// 解决方案:
    /// - 检查税率层级配置的有效性
    /// - 确认层级参数在允许范围内
    #[msg("Invalid tax tier configuration")]
    InvalidTaxTier,
    
    /// 税率层级必须按升序排列
    /// 
    /// 触发场景:
    /// - 税率层级配置未按升序排列
    /// - 层级顺序错误
    /// 
    /// 解决方案:
    /// - 确保税率层级按从小到大排列
    /// - 重新配置税率层级
    #[msg("Tax tiers must be in ascending order")]
    TaxTiersNotAscending,
    
    /// 税率层级数量过多
    /// 
    /// 触发场景:
    /// - 尝试配置超过MAX_TAX_TIERS (10)个层级
    /// 
    /// 解决方案:
    /// - 减少税率层级数量
    /// - 合并相似的层级
    #[msg("Too many tax tiers")]
    TooManyTaxTiers,
    
    /// 税率计算溢出
    /// 
    /// 触发场景:
    /// - 税率计算过程中发生数值溢出
    /// - 金额过大导致计算溢出
    /// 
    /// 解决方案:
    /// - 减少转账金额
    /// - 检查计算过程中的数值范围
    #[msg("Tax calculation overflow")]
    TaxCalculationOverflow,
    
    /// 无效的持有期间
    /// 
    /// 触发场景:
    /// - 持有时间计算出现负数
    /// - 时间戳无效
    /// 
    /// 解决方案:
    /// - 检查时间戳的有效性
    /// - 确认持有时间的计算逻辑
    #[msg("Invalid holding period")]
    InvalidHoldingPeriod,
    
    /// 税率过高
    /// 
    /// 触发场景:
    /// - 尝试设置过高的税率
    /// - 计算出的税率超过合理范围
    /// 
    /// 解决方案:
    /// - 降低税率设置
    /// - 检查税率参数的有效性
    #[msg("Tax too high")]
    TaxTooHigh,
    
    /// 地址已在免税列表中
    /// 
    /// 触发场景:
    /// - 尝试添加已存在的免税地址
    /// 
    /// 解决方案:
    /// - 检查地址是否已在列表中
    /// - 无需重复添加
    #[msg("Address already exempt")]
    AddressAlreadyExempt,
    
    /// 地址不在免税列表中
    /// 
    /// 触发场景:
    /// - 尝试移除不存在的免税地址
    /// 
    /// 解决方案:
    /// - 检查地址是否在列表中
    /// - 确认地址的正确性
    #[msg("Address not exempt")]
    AddressNotExempt,
    
    /// 免税地址数量过多
    /// 
    /// 触发场景:
    /// - 尝试添加超过MAX_TAX_EXEMPT_ADDRESSES (50)个免税地址
    /// 
    /// 解决方案:
    /// - 先移除一些不需要的免税地址
    /// - 合并相似的地址
    #[msg("Too many exempt addresses")]
    TooManyExemptAddresses,

    // ============================================
    // 持有者错误 (6040-6059)
    // ============================================
    
    /// 持有者账户已存在
    /// 
    /// 触发场景:
    /// - 尝试重复初始化同一个钱包的持有者信息
    /// 
    /// 解决方案:
    /// - 使用已存在的持有者账户
    /// - 检查账户是否已经初始化
    #[msg("Holder account already exists")]
    HolderAlreadyExists,
    
    /// 持有者账户不存在
    /// 
    /// 触发场景:
    /// - 尝试操作不存在的持有者账户
    /// - 持有者信息未初始化
    /// 
    /// 解决方案:
    /// - 先调用initialize_holder初始化账户
    /// - 确认账户已创建
    #[msg("Holder account not found")]
    HolderNotFound,
    
    /// 持有者账户已被冻结
    /// 
    /// 触发场景:
    /// - 尝试从冻结账户进行转账
    /// - 账户处于冻结状态
    /// 
    /// 解决方案:
    /// - 等待管理员解冻账户
    /// - 联系管理员了解冻结原因
    #[msg("Holder account is frozen")]
    HolderFrozen,
    
    /// 持有者账户未被冻结
    /// 
    /// 触发场景:
    /// - 尝试解冻未冻结的账户
    /// 
    /// 解决方案:
    /// - 检查账户的冻结状态
    /// - 确认是否需要解冻操作
    #[msg("Holder account is not frozen")]
    HolderNotFrozen,
    
    /// 无效的持有者所有者
    /// 
    /// 触发场景:
    /// - 持有者账户的所有者地址不匹配
    /// - 权限验证失败
    /// 
    /// 解决方案:
    /// - 确认使用正确的钱包地址
    /// - 检查账户的所有者字段
    #[msg("Invalid holder owner")]
    InvalidHolderOwner,
    
    /// 持有者统计更新失败
    /// 
    /// 触发场景:
    /// - 更新持有者统计信息时发生错误
    /// - 数值计算溢出
    /// 
    /// 解决方案:
    /// - 检查数值范围
    /// - 确认更新逻辑的正确性
    #[msg("Holder stats update failed")]
    HolderStatsUpdateFailed,
    
    /// 字符串长度过长
    /// 
    /// 触发场景:
    /// - 冻结原因字符串超过MAX_FREEZE_REASON_LEN (100字符)
    /// - 其他字符串字段超过限制
    /// 
    /// 解决方案:
    /// - 缩短字符串长度
    /// - 使用更简洁的描述
    #[msg("String too long")]
    StringTooLong,

    // ============================================
    // 转账错误 (6060-6079)
    // ============================================
    
    /// 转账金额为零
    /// 
    /// 触发场景:
    /// - 尝试转账0个代币
    /// - 金额参数为0
    /// 
    /// 解决方案:
    /// - 确保转账金额大于0
    /// - 检查金额参数的有效性
    #[msg("Transfer amount is zero")]
    ZeroTransferAmount,
    
    /// 账户余额不足
    /// 
    /// 触发场景:
    /// - 尝试转账超过账户余额的代币数量
    /// - 账户余额 < 转账金额 + 税额
    /// 
    /// 解决方案:
    /// - 检查账户余额
    /// - 减少转账金额
    /// - 考虑税收后的实际需求
    #[msg("Insufficient balance for transfer")]
    InsufficientBalance,
    
    /// 不允许转账给自己
    /// 
    /// 触发场景:
    /// - 尝试将代币转账到自己的账户
    /// - 发送者和接收者是同一地址
    /// 
    /// 解决方案:
    /// - 使用不同的接收者地址
    /// - 确认转账目标正确
    #[msg("Transfer to self not allowed")]
    TransferToSelf,
    
    /// Transfer Hook验证失败
    /// 
    /// 触发场景:
    /// - Transfer Hook程序验证失败
    /// - Transfer Hook执行出错
    /// 
    /// 解决方案:
    /// - 检查Transfer Hook程序的配置
    /// - 确认转账符合Hook的要求
    #[msg("Transfer hook validation failed")]
    TransferHookFailed,
    
    /// Transfer Hook已暂停
    /// 
    /// 触发场景:
    /// - Hook被管理员暂停
    /// - 系统维护中
    /// 
    /// 解决方案:
    /// - 等待Hook恢复
    /// - 联系管理员
    #[msg("Transfer hook is paused")]
    HookPaused,
    
    /// 无效的转账目标
    /// 
    /// 触发场景:
    /// - 转账目标地址无效
    /// - 目标账户不符合要求
    /// 
    /// 解决方案:
    /// - 检查目标地址的有效性
    /// - 确认目标账户已创建
    #[msg("Invalid transfer destination")]
    InvalidTransferDestination,
    
    /// 扣除税收后金额过小
    /// 
    /// 触发场景:
    /// - 扣除税收后，净转账金额为0或负数
    /// - 税率过高导致净额不足
    /// 
    /// 解决方案:
    /// - 增加转账金额
    /// - 检查税率是否合理
    #[msg("Transfer amount too small after tax")]
    TransferAmountTooSmall,
    
    /// 无效的金额
    /// 
    /// 触发场景:
    /// - 金额参数无效或超出范围
    /// - 金额验证失败
    /// 
    /// 解决方案:
    /// - 确保金额在有效范围内
    /// - 检查金额参数的类型和值
    #[msg("Invalid amount")]
    InvalidAmount,
    
    /// 无效的所有者
    /// 
    /// 触发场景:
    /// - 账户所有者地址不匹配
    /// - 权限验证失败
    /// 
    /// 解决方案:
    /// - 确认使用正确的账户所有者
    /// - 检查账户的所有者字段
    #[msg("Invalid owner")]
    InvalidOwner,
    
    /// 无效的税收收集账户
    /// 
    /// 触发场景:
    /// - 税收收集账户地址不匹配
    /// - 税收收集账户验证失败
    /// 
    /// 解决方案:
    /// - 确认使用正确的税收收集账户
    /// - 检查账户配置
    #[msg("Invalid tax collector")]
    InvalidTaxCollector,
    
    /// 代币账户不匹配
    /// 
    /// 触发场景:
    /// - 代币账户的Mint地址不匹配
    /// - 代币账户与池子账户不匹配
    /// 
    /// 解决方案:
    /// - 确认使用正确的代币账户
    /// - 检查账户的Mint地址
    #[msg("Token account mismatch")]
    TokenAccountMismatch,

    // ============================================
    // 管理员错误 (6080-6099)
    // ============================================
    
    /// 未授权操作
    /// 
    /// 触发场景:
    /// - 非管理员尝试执行管理员操作
    /// - 权限验证失败
    /// 
    /// 解决方案:
    /// - 确认使用管理员账户
    /// - 检查账户权限
    #[msg("Unauthorized - admin only")]
    Unauthorized,
    
    /// 无效的新管理员地址
    /// 
    /// 触发场景:
    /// - 尝试将管理员设置为空地址
    /// - 新管理员地址无效
    /// 
    /// 解决方案:
    /// - 使用有效的钱包地址
    /// - 不能使用Pubkey::default()
    #[msg("Invalid new authority")]
    InvalidNewAuthority,
    
    /// 操作已暂停
    /// 
    /// 触发场景:
    /// - 系统处于暂停状态时尝试执行某些操作
    /// - 恐慌模式激活
    /// 
    /// 解决方案:
    /// - 等待系统恢复
    /// - 联系管理员了解暂停原因
    #[msg("Operation paused")]
    OperationPaused,
    
    /// 系统未暂停
    /// 
    /// 触发场景:
    /// - 尝试在系统未暂停时执行需要暂停状态的操作（如紧急提取）
    /// 
    /// 解决方案:
    /// - 先暂停系统
    /// - 确认操作是否需要暂停状态
    #[msg("System not paused")]
    SystemNotPaused,
    
    /// 无效的参数
    /// 
    /// 触发场景:
    /// - 参数值超出允许范围
    /// - 参数类型不匹配
    /// 
    /// 解决方案:
    /// - 检查参数的有效性
    /// - 确认参数在允许范围内
    #[msg("Invalid parameter")]
    InvalidParameter,
    
    /// 冻结原因过长
    /// 
    /// 触发场景:
    /// - 冻结原因字符串超过MAX_FREEZE_REASON_LEN (100字符)
    /// 
    /// 解决方案:
    /// - 缩短冻结原因描述
    /// - 使用更简洁的文字
    #[msg("Freeze reason too long")]
    FreezeReasonTooLong,
    
    /// 系统已暂停
    /// 
    /// 触发场景:
    /// - 系统处于暂停状态
    /// - 恐慌模式激活
    /// 
    /// 解决方案:
    /// - 等待系统恢复
    /// - 联系管理员
    #[msg("System paused")]
    SystemPaused,

    // ============================================
    // 数学错误 (6100-6109)
    // ============================================
    
    /// 数学运算溢出
    /// 
    /// 触发场景:
    /// - 乘法运算结果超过u64最大值
    /// - 加法运算结果溢出
    /// 
    /// 解决方案:
    /// - 使用checked_mul、checked_add等安全运算
    /// - 减少运算数值的大小
    /// - 检查数值范围
    #[msg("Math overflow")]
    MathOverflow,
    
    /// 数学运算下溢
    /// 
    /// 触发场景:
    /// - 减法运算结果小于0（对于无符号整数）
    /// - 尝试从较小值减去较大值
    /// 
    /// 解决方案:
    /// - 使用checked_sub等安全运算
    /// - 确保被减数 >= 减数
    /// - 检查数值关系
    #[msg("Math underflow")]
    MathUnderflow,
    
    /// 除以零错误
    /// 
    /// 触发场景:
    /// - 尝试除以0
    /// - 除数为0
    /// 
    /// 解决方案:
    /// - 检查除数是否为0
    /// - 在除法前验证除数
    /// - 使用安全除法函数
    #[msg("Division by zero")]
    DivisionByZero,

    // ============================================
    // 时间错误 (6110-6119)
    // ============================================
    
    /// 无效的时间戳
    /// 
    /// 触发场景:
    /// - 时间戳为0或负数
    /// - 时间戳无效
    /// 
    /// 解决方案:
    /// - 确保时间戳 > 0
    /// - 使用有效的时间戳值
    #[msg("Invalid timestamp")]
    InvalidTimestamp,
    
    /// 锁定期未到期
    /// 
    /// 触发场景:
    /// - 尝试在锁定期内提取代币
    /// - 当前时间 < 解锁时间
    /// 
    /// 解决方案:
    /// - 等待锁定期到期
    /// - 检查解锁时间
    #[msg("Lock period not expired")]
    LockPeriodNotExpired,
    
    /// 释放期未开始
    /// 
    /// 触发场景:
    /// - 尝试在释放期开始前提取代币
    /// - 当前时间 < vesting_start
    /// 
    /// 解决方案:
    /// - 等待释放期开始
    /// - 检查vesting_start时间
    #[msg("Vesting not started")]
    VestingNotStarted,
    
    /// 无效的时间参数
    /// 
    /// 触发场景:
    /// - 时间参数无效或超出范围
    /// - 时间计算错误
    /// 
    /// 解决方案:
    /// - 检查时间参数的有效性
    /// - 确认时间参数在合理范围内
    #[msg("Invalid time parameter")]
    InvalidTimeParameter,
}
