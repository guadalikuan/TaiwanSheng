# åœ°å ¡é¿é™©åŠŸèƒ½å®ç°çŠ¶æ€

## âœ… å®ç°å®ŒæˆçŠ¶æ€

æ‰€æœ‰åœ°å ¡é¿é™©åŠŸèƒ½å·²å®Œæ•´å®ç°å¹¶æµ‹è¯•é€šè¿‡ã€‚

---

## ğŸ“Š å·²å®ç°åŠŸèƒ½æ¸…å•

### 1. âœ… ä»£å¸é¿é™©åŠŸèƒ½

**åç«¯å®ç°**ï¼š`server/routes/bunker.js`
```javascript
// æ¯10,000 TWS = +1%ï¼Œæœ€é«˜30%
const tokenBonus = Math.min((twsBalance || 0) / 10000, 30);
```

**å‰ç«¯æ˜¾ç¤º**ï¼š`src/components/BunkerApp.jsx`
- TWSä»£å¸å¡ç‰‡æ˜¾ç¤ºä½™é¢å’Œé¿é™©åŠ æˆ
- æ˜¾ç¤º"æ¯ 10,000 TWS = +1%ï¼ˆæœ€é«˜+30%ï¼‰"
- æ˜¾ç¤ºå®é™…åŠ æˆç™¾åˆ†æ¯”

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 2. âœ… æˆ¿äº§é¿é™©åŠŸèƒ½

**åç«¯å®ç°**ï¼š`server/routes/bunker.js`
```javascript
// æ¯ä¸ªæˆ¿äº§ = 15% + (ä½ç½®ç³»æ•° Ã— 5%) + (é¢ç§¯ç³»æ•° Ã— 3%)
let bonus = 15;
const locationFactor = getLocationCoefficient(cityName);
bonus += locationFactor * 5; // ä½ç½®ç³»æ•° Ã— 5%
bonus += areaFactor * 3; // é¢ç§¯ç³»æ•° Ã— 3%
```

**ä½ç½®ç³»æ•°**ï¼š`server/utils/locationCoefficient.js`
- è¦†ç›–å…¨å›½ 400+ åŸå¸‚
- æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œçœä»½åŒ¹é…
- ç³»æ•°èŒƒå›´ï¼š0.5-2.0

**é¢ç§¯ç³»æ•°**ï¼š
- å•å…µèˆ±ï¼ˆ<50ã¡ï¼‰ï¼š0.5 â†’ +1.5%
- é¿éš¾æ‰€ï¼ˆ50-90ã¡ï¼‰ï¼š1.0 â†’ +3%
- åœ°å ¡ï¼ˆ90-140ã¡ï¼‰ï¼š1.5 â†’ +4.5%
- æŒ‡æŒ¥æ‰€ï¼ˆ>140ã¡ï¼‰ï¼š2.0 â†’ +6%

**å‰ç«¯æ˜¾ç¤º**ï¼š
- æˆ¿äº§å¡ç‰‡æ˜¾ç¤ºé¿é™©åŠ æˆ
- ç‚¹å‡»æˆ¿äº§æŸ¥çœ‹è¯¦ç»†åœºæ™¯

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 3. âœ… ç»„åˆåŠ æˆåŠŸèƒ½

**åç«¯å®ç°**ï¼š`server/routes/bunker.js`
```javascript
// å¦‚æœåŒæ—¶æŒæœ‰ä»£å¸å’Œæˆ¿äº§ï¼Œæ€»åŠ æˆæå‡10%
let combinationBonus = 0;
if (tokenBonus > 0 && assetBonus > 0) {
  combinationBonus = (tokenBonus + assetBonus) * 0.1;
}
```

**å‰ç«¯æ˜¾ç¤º**ï¼š
- é¿é™©èƒ½åŠ›è¯¦æƒ…é¢æ¿æ˜¾ç¤ºç»„åˆåŠ æˆ
- ä»…åœ¨åŒæ—¶æŒæœ‰ä»£å¸å’Œæˆ¿äº§æ—¶æ˜¾ç¤º

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 4. âœ… é£é™©æƒ©ç½šåŠŸèƒ½ï¼ˆåŸºäºå€’è®¡æ—¶å±æœºæ„Ÿï¼‰

**å€’è®¡æ—¶å±æœºæ„Ÿè®¡ç®—**ï¼š`server/routes/bunker.js`
```javascript
// å€’è®¡æ—¶è¶Šæ¥è¿‘ï¼Œå±æœºæ„Ÿåˆ†æ•°è¶Šé«˜ï¼ˆ0-100ï¼‰
if (daysRemaining <= 7) {
  crisisScore = 100 - (daysRemaining * 10); // 30-100åˆ†
} else if (daysRemaining <= 30) {
  crisisScore = 50 + ((30 - daysRemaining) * 2); // 50-96åˆ†
} // ... å…¶ä»–åŒºé—´

// é£é™©åˆ†æ•° = (é£é™©æº¢ä»· Ã— 50%) + (å±æœºæ„Ÿåˆ†æ•° Ã— 50%)
riskScore = (riskPremium * 0.5) + (crisisScore * 0.5);
```

**é£é™©æƒ©ç½š**ï¼š
```javascript
const riskPenalty = {
  'CRITICAL': -20,  // 80-100åˆ†
  'HIGH': -10,     // 60-79åˆ†
  'MEDIUM': 0,     // 40-59åˆ†
  'LOW': 5         // 0-39åˆ†ï¼ˆå¥–åŠ±ï¼‰
}[riskLevel] || 0;
```

**å‰ç«¯æ˜¾ç¤º**ï¼š
- å€’è®¡æ—¶æ˜¾ç¤ºï¼ˆå¤©æ•°ã€å°æ—¶ã€åˆ†é’Ÿï¼‰
- å±æœºæ„Ÿåˆ†æ•°å’Œç­‰çº§
- é£é™©ç­‰çº§å’Œæƒ©ç½šå€¼
- ç´§æ€¥è­¦æŠ¥ï¼ˆCRITICAL/HIGHæ—¶ï¼‰

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 5. âœ… ç”Ÿå­˜ç‡è®¡ç®—

**å®Œæ•´å…¬å¼**ï¼š
```javascript
ç”Ÿå­˜ç‡ = 34% + ä»£å¸é¿é™© + æˆ¿äº§é¿é™© + ç»„åˆåŠ æˆ - é£é™©æƒ©ç½š
```

**åç«¯API**ï¼š`GET /api/bunker/refuge-capacity`
- è¿”å›å®Œæ•´çš„é¿é™©èƒ½åŠ›è¯¦æƒ…
- åŒ…æ‹¬æ‰€æœ‰åŠ æˆåˆ†è§£

**å‰ç«¯æ˜¾ç¤º**ï¼š
- ç¯å½¢è¿›åº¦æ¡æ˜¾ç¤ºç”Ÿå­˜ç‡
- é¿é™©èƒ½åŠ›è¯¦æƒ…é¢æ¿ï¼ˆå¯å±•å¼€ï¼‰
- å®æ—¶æ›´æ–°ï¼ˆæ¯30ç§’ï¼‰

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

### 6. âœ… ä½ç½®ç³»æ•°ç³»ç»Ÿ

**å®ç°æ–‡ä»¶**ï¼š`server/utils/locationCoefficient.js`

**è¦†ç›–èŒƒå›´**ï¼š
- å…¨å›½ 400+ ä¸»è¦åŸå¸‚
- æ‰€æœ‰çœä¼šåŸå¸‚
- æ‰€æœ‰åœ°çº§å¸‚
- ä¸»è¦å¿çº§å¸‚

**ç³»æ•°åˆ†çº§**ï¼š
- 2.0ï¼šæ–°ç–†ã€è¥¿è—ï¼ˆæåº¦å®‰å…¨ï¼‰
- 1.5-1.8ï¼šè¥¿åŒ—ã€è¥¿å—ï¼ˆé«˜åº¦å®‰å…¨ï¼‰
- 1.0-1.5ï¼šåä¸­ã€ååŒ—ï¼ˆä¸­ç­‰å®‰å…¨ï¼‰
- 0.5-1.0ï¼šåä¸œã€åå—ï¼ˆè¾ƒä½å®‰å…¨ï¼‰

**åŒ¹é…æœºåˆ¶**ï¼š
- ç›´æ¥åŒ¹é…
- æ¨¡ç³ŠåŒ¹é…
- çœä»½åŒ¹é…
- é»˜è®¤å€¼ï¼š1.0

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·è¿›å…¥åœ°å ¡
    â†“
å¹¶è¡ŒåŠ è½½æ•°æ®
    â”œâ”€â†’ GET /api/homepage/assetsï¼ˆèµ„äº§åˆ—è¡¨ï¼‰
    â”œâ”€â†’ GET /api/bunker/riskï¼ˆé£é™©é¢„è­¦+å€’è®¡æ—¶ï¼‰
    â”œâ”€â†’ GET /api/bunker/statsï¼ˆç¤¾åŒºç»Ÿè®¡ï¼‰
    â””â”€â†’ GET /api/bunker/refuge-capacityï¼ˆé¿é™©èƒ½åŠ›ï¼‰
    â†“
è®¡ç®—ç”Ÿå­˜ç‡
    â”œâ”€â†’ åŸºç¡€ï¼š34%
    â”œâ”€â†’ ä»£å¸é¿é™©ï¼šmin(ä½™é¢/10000, 30)%
    â”œâ”€â†’ æˆ¿äº§é¿é™©ï¼šsum(15% + ä½ç½®Ã—5% + é¢ç§¯Ã—3%)
    â”œâ”€â†’ ç»„åˆåŠ æˆï¼š(ä»£å¸+æˆ¿äº§) Ã— 10%
    â””â”€â†’ é£é™©æƒ©ç½šï¼šåŸºäºå€’è®¡æ—¶å±æœºæ„Ÿ
    â†“
æ¸²æŸ“ç•Œé¢
    â”œâ”€â†’ ç”Ÿå­˜ç‡ä»ªè¡¨ç›˜
    â”œâ”€â†’ å€’è®¡æ—¶æ˜¾ç¤º
    â”œâ”€â†’ é£é™©ç­‰çº§
    â”œâ”€â†’ èµ„äº§åˆ—è¡¨
    â””â”€â†’ é¿é™©èƒ½åŠ›è¯¦æƒ…
    â†“
å®æ—¶æ›´æ–°ï¼ˆæ¯30ç§’ï¼‰
```

---

## ğŸ“ å…³é”®æ–‡ä»¶

### åç«¯
- `server/routes/bunker.js` - é¿é™©èƒ½åŠ›è®¡ç®—API
- `server/utils/locationCoefficient.js` - å…¨å›½ä½ç½®ç³»æ•°è¡¨
- `server/utils/timeManager.js` - å€’è®¡æ—¶ç®¡ç†

### å‰ç«¯
- `src/components/BunkerApp.jsx` - åœ°å ¡ä¸»ç•Œé¢
- `src/utils/api.js` - APIè°ƒç”¨å‡½æ•°

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

- [x] ä»£å¸é¿é™©åŠ æˆè®¡ç®—æ­£ç¡®
- [x] æˆ¿äº§é¿é™©åŠ æˆè®¡ç®—æ­£ç¡®ï¼ˆä½ç½®+é¢ç§¯ï¼‰
- [x] ç»„åˆåŠ æˆè®¡ç®—æ­£ç¡®
- [x] é£é™©æƒ©ç½šè®¡ç®—æ­£ç¡®ï¼ˆåŸºäºå€’è®¡æ—¶ï¼‰
- [x] å€’è®¡æ—¶å±æœºæ„Ÿè®¡ç®—æ­£ç¡®
- [x] ä½ç½®ç³»æ•°æŸ¥è¯¢æ­£ç¡®ï¼ˆå…¨å›½400+åŸå¸‚ï¼‰
- [x] å‰ç«¯æ˜¾ç¤ºå®Œæ•´
- [x] å®æ—¶æ›´æ–°æ­£å¸¸ï¼ˆæ¯30ç§’ï¼‰
- [x] ç´§æ€¥è­¦æŠ¥è§¦å‘æ­£å¸¸

---

## ğŸ¯ æ€»ç»“

**æ‰€æœ‰åœ°å ¡é¿é™©åŠŸèƒ½å·²å®Œæ•´å®ç°**ï¼š

1. âœ… ä»£å¸é¿é™©ï¼šæ¯10,000 TWS = +1%ï¼ˆæœ€é«˜30%ï¼‰
2. âœ… æˆ¿äº§é¿é™©ï¼šæ¯ä¸ªæˆ¿äº§ +15% èµ·ï¼ˆä½ç½®ç³»æ•°Ã—5% + é¢ç§¯ç³»æ•°Ã—3%ï¼‰
3. âœ… ç»„åˆåŠ æˆï¼šåŒæ—¶æŒæœ‰ä»£å¸å’Œæˆ¿äº§ï¼Œé¢å¤–+10%
4. âœ… é£é™©æƒ©ç½šï¼šåŸºäºå€’è®¡æ—¶å±æœºæ„Ÿï¼ˆCRITICAL:-20%, HIGH:-10%, MEDIUM:0, LOW:+5%ï¼‰
5. âœ… å€’è®¡æ—¶å±æœºæ„Ÿï¼šå é£é™©åˆ†æ•°50%
6. âœ… ä½ç½®ç³»æ•°ï¼šè¦†ç›–å…¨å›½400+åŸå¸‚

**æ ¸å¿ƒå…¬å¼**ï¼š
```
ç”Ÿå­˜ç‡ = 34% + ä»£å¸é¿é™© + æˆ¿äº§é¿é™© + ç»„åˆåŠ æˆ - é£é™©æƒ©ç½š
```

**çŠ¶æ€**ï¼šâœ… æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶å¯ç”¨

