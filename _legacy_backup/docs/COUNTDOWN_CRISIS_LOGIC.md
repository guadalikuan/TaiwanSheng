# 倒计时危机感逻辑

## 🎯 核心设计

**危机感来源**：倒计时（ETU - Estimated Time to Unification）

倒计时越接近，危机感越强，驱动用户购买更多资产避险。

---

## ⏰ 倒计时危机感计算

### 危机感分数（0-100）

**计算公式**：
```
根据剩余天数计算危机感分数：

- 7天内：    危机感 = 100 - (剩余天数 × 10)  → 30-100分
- 30天内：   危机感 = 50 + ((30 - 剩余天数) × 2)  → 50-96分
- 90天内：   危机感 = 30 + ((90 - 剩余天数) × 0.3)  → 30-48分
- 365天内：  危机感 = 20 + ((365 - 剩余天数) × 0.03)  → 20-30分
- 1年以上：  危机感 = max(10, 20 - ((剩余天数 - 365) × 0.01))  → 10-20分
```

### 危机等级

| 危机感分数 | 等级 | 描述 |
|-----------|------|------|
| 80-100 | CRITICAL | 極度危險（7天内） |
| 60-79 | HIGH | 高度危險（14天内） |
| 40-59 | MEDIUM | 中等危險（30天内） |
| 0-39 | LOW | 低危險（30天以上） |

---

## 📊 倒计时对风险等级的影响

### 风险分数计算

```
风险分数 = (风险溢价分数 × 50%) + (倒计时危机感分数 × 50%)
```

**说明**：
- 倒计时危机感占风险分数的 **50%**
- 风险溢价和事件占风险分数的 **50%**
- 倒计时越接近，风险分数越高

### 示例

**场景 1：倒计时 600 天**
- 危机感分数：15分
- 风险溢价：50分
- 风险分数 = (50 × 50%) + (15 × 50%) = **32.5分** → LOW

**场景 2：倒计时 30 天**
- 危机感分数：50分
- 风险溢价：50分
- 风险分数 = (50 × 50%) + (50 × 50%) = **50分** → MEDIUM

**场景 3：倒计时 7 天**
- 危机感分数：80分
- 风险溢价：50分
- 风险分数 = (50 × 50%) + (80 × 50%) = **65分** → HIGH

**场景 4：倒计时 3 天**
- 危机感分数：100分
- 风险溢价：50分
- 风险分数 = (50 × 50%) + (100 × 50%) = **75分** → HIGH

**场景 5：倒计时 1 天**
- 危机感分数：100分
- 风险溢价：50分
- 风险分数 = (50 × 50%) + (100 × 50%) = **75分** → HIGH

---

## 🔄 倒计时对生存率的影响

### 风险惩罚（基于风险等级）

```
风险等级 → 风险惩罚：
- CRITICAL：-20%
- HIGH：-10%
- MEDIUM：0%
- LOW：+5%（奖励）
```

### 完整流程

```
倒计时接近
    ↓
危机感分数上升
    ↓
风险分数上升
    ↓
风险等级提升（LOW → MEDIUM → HIGH → CRITICAL）
    ↓
风险惩罚增加（+5% → 0% → -10% → -20%）
    ↓
生存率下降
    ↓
用户产生紧迫感
    ↓
购买更多资产
```

---

## 📈 倒计时显示

### 地堡页面显示

**位置**：顶部风险预警区域

**显示内容**：
- 剩余天数、小时、分钟
- 危机感分数
- 危机等级
- 警告提示（7天内显示）

**UI 样式**：
- 7天内：红色背景，闪烁警告
- 30天内：橙色背景
- 30天以上：黄色背景

---

## 🎯 心理作用

### 1. 紧迫感驱动

**机制**：
- 倒计时越接近，危机感越强
- 生存率下降，驱动用户购买资产

**效果**：
- ✅ **FOMO（错失恐惧）**：看到倒计时接近，产生"我需要立即准备"的冲动
- ✅ **真实感**：倒计时让用户感觉"这是真的，不是游戏"

### 2. 量化危机感

**机制**：
- 将抽象的"危机"转化为具体的数字（0-100分）
- 与倒计时天数直接关联

**效果**：
- ✅ **可感知**：用户可以看到危机感的具体数值
- ✅ **可控制**：用户知道"还有多少天"，可以提前准备

### 3. 动态调整

**机制**：
- 倒计时实时更新
- 危机感分数实时计算
- 风险等级动态调整

**效果**：
- ✅ **真实感**：让用户感觉"这是动态的，不是静态的"
- ✅ **紧迫感**：看到倒计时减少，产生紧迫感

---

## 💡 实施细节

### 后端实现

**文件**：`server/routes/bunker.js`

**函数**：
- `calculateCountdownCrisis(targetTime)` - 计算倒计时危机感
- `calculateRiskLevel(riskPremium, events, countdownCrisis)` - 计算风险等级（包含倒计时）

**API 返回**：
```json
{
  "riskLevel": "HIGH",
  "riskScore": 65,
  "countdown": {
    "daysRemaining": 7,
    "hoursRemaining": 12,
    "minutesRemaining": 30,
    "crisisScore": 80,
    "crisisLevel": "CRITICAL",
    "targetTime": 1816524211671
  }
}
```

### 前端实现

**文件**：`src/components/BunkerApp.jsx`

**显示**：
- 倒计时显示（天数、小时、分钟）
- 危机感分数
- 警告提示（7天内）

---

## ✅ 总结

**核心逻辑**：
> 倒计时越接近，危机感越强，风险等级越高，生存率下降，驱动用户购买更多资产。

**公式**：
```
危机感分数 = f(剩余天数)
风险分数 = (风险溢价 × 50%) + (危机感分数 × 50%)
风险等级 = g(风险分数)
风险惩罚 = h(风险等级)
生存率 = 34% + 代币避险 + 房产避险 + 组合加成 - 风险惩罚
```

**关键点**：
- 倒计时是危机感的主要来源（占风险分数 50%）
- 倒计时越接近，危机感越强
- 危机感驱动用户购买资产避险
