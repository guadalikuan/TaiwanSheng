# 高德地图 API 配置测试总结

## ✅ 测试环境已准备完成

### 1. 代码集成 ✅

- ✅ 创建了高德地图 API 封装工具 (`src/utils/amapApi.js`)
- ✅ 更新了地图组件 (`src/components/MapLocationPicker.jsx`)
- ✅ 实现了智能回退机制（高德 -> Nominatim）
- ✅ 创建了测试组件 (`src/components/AmapConfigTest.jsx`)
- ✅ 添加了测试路由 (`/test-amap`)

### 2. 环境变量配置 ⚠️

当前 `.env` 文件中已添加 `VITE_AMAP_API_KEY` 占位符，但值尚未设置。

**下一步**: 需要将实际的高德地图 API Key 填入 `.env` 文件。

---

## 🧪 测试方法

### 方法 1: 使用测试页面（推荐）

1. **启动开发服务器**（如果未启动）:
   ```bash
   npm run dev
   ```

2. **访问测试页面**:
   ```
   http://localhost:5173/test-amap
   ```

3. **查看测试结果**:
   - 如果未配置 API Key: 会显示"未配置"提示，说明将使用 Nominatim 回退方案
   - 如果已配置 API Key: 会显示"已配置"，并可点击测试按钮进行功能测试

### 方法 2: 在实际页面中测试

1. **访问资产入库页面**:
   ```
   http://localhost:5173/arsenal
   ```

2. **测试地址搜索**:
   - 在地图搜索框中输入"信达辰樾府"
   - 点击搜索按钮
   - 查看搜索结果

3. **检查使用的 API**:
   - 打开浏览器开发者工具（F12）
   - 切换到"网络"标签
   - 搜索后查看请求：
     - `restapi.amap.com` = 使用高德地图 API ✅
     - `nominatim.openstreetmap.org` = 使用 Nominatim 回退方案

---

## 📝 配置 API Key

### 步骤 1: 获取 API Key

1. 访问 [高德开放平台](https://console.amap.com/)
2. 注册/登录账号
3. 创建新应用
4. 添加 "Web服务" 类型的 Key
5. 复制生成的 API Key

### 步骤 2: 配置到 .env 文件

编辑项目根目录的 `.env` 文件，找到：

```bash
VITE_AMAP_API_KEY=
```

改为：

```bash
VITE_AMAP_API_KEY=你的实际API_Key
```

**注意**: 
- 不要包含引号
- 不要有空格
- 保存文件后需要**重启开发服务器**

### 步骤 3: 验证配置

1. 重启开发服务器
2. 访问测试页面：`http://localhost:5173/test-amap`
3. 应该看到"✅ 已检测到高德地图 API Key 配置"

---

## 🎯 预期测试结果

### 场景 1: 未配置 API Key

**测试页面显示**:
- ⚠️ API Key 配置状态: 未配置
- 提示将使用 Nominatim 回退方案

**实际使用**:
- 地图搜索功能仍可正常使用
- 搜索结果准确性可能较低
- 可能无法准确搜索新建楼盘

### 场景 2: 已配置 API Key（有效）

**测试页面显示**:
- ✅ API Key 配置状态: 已配置
- POI 搜索测试: ✅ 成功（返回搜索结果）
- 逆地理编码测试: ✅ 成功（返回地址信息）

**实际使用**:
- 地图搜索功能准确性高
- 能准确搜索"信达辰樾府"等新建楼盘
- 地址信息详细完整

### 场景 3: 已配置但 API Key 无效

**测试页面显示**:
- ✅ API Key 配置状态: 已配置
- POI 搜索测试: ❌ 失败（显示错误信息）
- 错误信息可能包含: "INVALID_USER_KEY" 或类似

**解决方法**:
1. 检查 API Key 是否正确复制
2. 登录高德开放平台，确认 API Key 状态
3. 确认已添加"Web服务"服务类型

---

## 🔍 调试信息

### 浏览器控制台

如果遇到问题，打开浏览器开发者工具（F12），查看控制台输出：

- `高德地图 POI 搜索错误:` - 高德 API 调用失败
- `高德地图搜索失败，回退到 Nominatim` - 自动使用回退方案
- `高德地图 API Key 未配置` - API Key 未设置

### 网络请求

在"网络"标签中查看：

- ✅ 请求到 `restapi.amap.com` = 使用高德地图 API
- ⚠️ 请求到 `nominatim.openstreetmap.org` = 使用 Nominatim 回退

---

## 📊 功能对比

| 功能 | 高德地图 API | Nominatim 回退 |
|------|------------|---------------|
| 配置要求 | 需要 API Key | 无需配置 |
| 中国地址准确性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 新建楼盘搜索 | ✅ 支持 | ⚠️ 可能失败 |
| POI 搜索 | ✅ 详细 | ⚠️ 有限 |
| 免费额度 | 30万次/天 | 无限制（可能限速） |
| 响应速度 | 快 | 中等 |

---

## ✅ 测试检查清单

- [ ] `.env` 文件中已添加 `VITE_AMAP_API_KEY`
- [ ] （可选）已填入实际的高德地图 API Key
- [ ] 已重启开发服务器
- [ ] 可以访问测试页面 `/test-amap`
- [ ] 测试页面显示正确的配置状态
- [ ] （如果已配置）POI 搜索测试通过
- [ ] （如果已配置）逆地理编码测试通过
- [ ] 在资产入库页面可以正常使用地图搜索

---

## 🎉 测试完成

如果所有测试通过，说明高德地图 API 集成成功！

现在你可以在资产入库页面享受更准确的地址搜索功能了。

---

**最后更新**: 2025-01-03  
**维护者**: TWS 开发团队

