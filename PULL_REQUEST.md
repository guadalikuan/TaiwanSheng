# Pull Request: 资产入库模块集成

## 📋 PR 描述

本 PR 集成了完整的资产入库模块和高德地图 API，实现了房地产资产的数字化管理和地理位置标注功能。

---

## ✨ 主要功能

### 1. 🏢 资产入库系统
- **独立认证系统**：资产入库使用独立的认证机制，与主站点分离
- **多角色支持**：支持管理员、开发商、审核员等不同角色
- **资产提交**：完整的资产信息提交表单，包括：
  - 基础信息（债权人、项目名称、楼号、门牌号）
  - 省市地区选择
  - 地图位置标注
  - 文件上传（房产证、工抵协议等）
  - 价值评估

### 2. 🗺️ 高德地图集成
- **地址搜索**：优先使用高德地图 API 进行 POI 搜索，提高中国地址搜索准确性
- **地理编码**：地址 → 坐标转换
- **逆地理编码**：坐标 → 地址转换
- **智能回退**：高德地图 API 失败时自动回退到 OpenStreetMap Nominatim
- **地图交互**：支持点击地图选择位置、拖动标记、坐标搜索等

### 3. 👥 用户管理
- **管理员功能**：创建、编辑、删除房地产开发商账户
- **账户管理**：完整的用户 CRUD 操作
- **权限控制**：基于角色的访问控制（RBAC）

### 4. ✅ 资产审核
- **审核界面**：审核员和管理员可以审核提交的资产
- **状态管理**：支持待审核、已批准、已拒绝、已锁定等状态
- **NFT 铸造**：审核通过后可以生成 TWS Land NFT
- **统计信息**：显示总资产、待审核、已批准、已拒绝、已锁定数量

### 5. 📊 资产列表
- **我的资产**：用户可以查看自己提交的资产列表
- **资产详情**：显示资产的完整信息和状态
- **状态筛选**：按状态筛选资产（待审核、已批准等）

---

## 🎯 技术实现

### 前端技术栈
- **React**：组件化开发
- **React Router**：路由管理
- **Leaflet.js**：地图显示和交互
- **Lucide React**：图标库
- **Tailwind CSS**：样式框架

### 后端技术栈
- **Node.js + Express**：API 服务
- **JWT**：身份认证
- **bcrypt**：密码加密
- **multer**：文件上传处理

### 新增文件
```
前端组件：
- `src/components/ArsenalEntry.jsx` - 资产入库主界面
- `src/components/ArsenalLogin.jsx` - 登录界面
- `src/components/ArsenalProtectedRoute.jsx` - 路由保护
- `src/components/MapLocationPicker.jsx` - 地图位置选择器
- `src/components/CommandCenter.jsx` - 审核中心
- `src/components/UserManagement.jsx` - 用户管理

后端路由：
- `server/routes/arsenal.js` - 资产入库 API
- `server/routes/users.js` - 用户管理 API

工具和上下文：
- `src/contexts/ArsenalAuthContext.jsx` - 独立认证系统
- `src/utils/amapApi.js` - 高德地图 API 封装
- `src/utils/chinaRegions.js` - 省市地区数据
```

---

## 🔧 配置要求

### 环境变量
需要在 `.env` 文件中配置：
```env
VITE_AMAP_API_KEY=your_gaode_api_key_here
```

### 获取高德地图 API Key
1. 访问：https://console.amap.com/
2. 注册/登录账号
3. 创建应用（类型：Web服务）
4. 添加 Key（类型：Web服务）
5. 复制 API Key 到 `.env` 文件

---

## 📈 数据流程

1. **资产提交**：
   - 用户填写资产信息
   - 在地图上标注位置
   - 上传相关文件
   - 提交到后端

2. **资产审核**：
   - 审核员查看待审核资产
   - 对比原始数据和脱敏数据
   - 批准或拒绝资产
   - 批准后可生成 NFT

3. **资产管理**：
   - 用户可以查看自己的资产
   - 管理员可以查看所有资产
   - 支持按状态筛选

---

## 🔒 安全特性

- **独立认证**：资产入库使用独立的认证系统，与主站点分离
- **角色权限**：基于角色的访问控制，确保只有授权用户可以访问相应功能
- **数据脱敏**：敏感信息自动脱敏处理
- **文件上传**：限制文件类型和大小
- **API 密钥**：环境变量存储敏感配置

---

## 🧪 测试建议

1. **资产提交测试**：
   - 测试表单验证
   - 测试地图位置选择
   - 测试文件上传
   - 测试省市选择

2. **地图功能测试**：
   - 测试地址搜索
   - 测试坐标搜索
   - 测试地图点击和拖动
   - 测试高德地图 API 回退机制

3. **权限测试**：
   - 测试不同角色的访问权限
   - 测试登录/登出功能
   - 测试路由保护

4. **审核功能测试**：
   - 测试资产审核流程
   - 测试状态变更
   - 测试 NFT 铸造（如果配置了区块链）

---

## 📝 代码统计

- **新增文件**：14 个
- **新增代码**：4529 行
- **修改文件**：14 个

---

## 🚀 部署说明

1. **安装依赖**：
   ```bash
   npm install
   cd server && npm install
   ```

2. **配置环境变量**：
   - 复制 `.env.example` 到 `.env`
   - 填写高德地图 API Key

3. **启动服务**：
   ```bash
   # 启动后端
   npm run dev:backend

   # 启动前端
   npm run dev
   ```

4. **访问地址**：
   - 资产入库：`http://localhost:5173/arsenal`
   - 资产审核：`http://localhost:5173/command`
   - 用户管理：`http://localhost:5173/admin/users`

---

## 📸 功能截图

（可在 GitHub 上添加功能截图）

---

## ✅ 检查清单

- [x] 代码已通过 lint 检查
- [x] 已添加必要的注释和文档
- [x] 已更新 .gitignore 排除敏感文件
- [x] 已修复 favicon 404 错误
- [x] 已集成高德地图 API
- [x] 已实现智能回退机制
- [x] 已实现角色权限控制
- [x] 已实现文件上传功能
- [x] 已实现地图位置选择功能

---

## 🔗 相关链接

- [高德开放平台](https://console.amap.com/)
- [高德地图 API 文档](https://lbs.amap.com/api/webservice/summary)
- [Leaflet.js 文档](https://leafletjs.com/)

---

## 💬 备注

- 高德地图 API Key 需要单独配置，不会提交到仓库
- 数据文件（`server/data/*.json`）不会提交，需要在服务器上初始化
- 文件上传目录（`server/uploads/`）需要确保有写入权限

---

**合并此 PR 后，资产入库模块将完全集成到 TWS 项目中。**

