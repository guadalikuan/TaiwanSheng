# 地堡避险逻辑完整设计

## 🎯 核心逻辑

**目的**：避险（战争/统一事件）  
**手段1**：买币（TWS代币）  
**手段2**：买房子（房产资产/地堡）

---

## 📊 避险价值体系

### 1. 买币的避险逻辑

#### 避险机制

**TWS代币 = 避险资产 + 流动性工具**

1. **避险价值**：
   - 代币价值与地缘政治风险挂钩
   - 风险上升 → 代币需求增加 → 价格上涨
   - 用户持有代币 = 持有"避险资产"

2. **流动性价值**：
   - 代币可用于购买房产资产
   - 代币可在市场交易（变现）
   - 代币可质押获得收益

3. **避险效果**：
   - 持有代币 → 提升生存率（+5% per 1000 TWS）
   - 代币价值随风险上升而上涨
   - 统一事件后，代币可兑换房产证

#### 购买逻辑

```
用户购买TWS代币
    ↓
使用USDT支付
    ↓
获得TWS代币（ERC20）
    ↓
代币存入用户钱包
    ↓
生存率提升（+5% per 1000 TWS）
    ↓
代币可用于：
1. 购买房产资产
2. 市场交易（变现）
3. 质押获得收益
```

---

### 2. 买房子的避险逻辑

#### 避险机制

**房产资产 = 物理避难所 + 确权凭证**

1. **物理避险**：
   - 房产位于大陆（远离台湾）
   - 统一事件后，可实际居住
   - 提供真实的"避难所"

2. **确权凭证**：
   - 资产代币化（ERC1155）
   - 链上确权，不可篡改
   - 统一事件后，可兑换房产证

3. **避险效果**：
   - 拥有房产 → 提升生存率（+15% per 房产）
   - 房产位置越偏远，避险价值越高
   - 房产面积越大，避险价值越高

#### 购买逻辑

```
用户选择房产资产
    ↓
使用USDT或TWS代币支付
    ↓
获得资产Token（ERC1155）
    ↓
资产存入用户钱包
    ↓
生存率提升（+15% per 房产）
    ↓
资产可用于：
1. 查看真实避难场景
2. 统一事件后兑换房产证
3. 转让给其他用户
```

---

### 3. 币和房子的关联

#### 关联机制

1. **购买关联**：
   - 可以用TWS代币购买房产
   - 可以用USDT购买TWS代币，再用TWS购买房产
   - 可以用USDT直接购买房产

2. **价值关联**：
   - 房产价格以TWS代币计价
   - 代币价格上涨 → 房产相对便宜
   - 代币价格下跌 → 房产相对昂贵

3. **避险关联**：
   - 持有代币 + 持有房产 = 双重避险
   - 代币提供流动性，房产提供物理保障
   - 两者结合，避险效果最大化

#### 组合避险效果

```
基础生存率：34%

+ 持有TWS代币：
  - 每1000 TWS = +5% 生存率
  - 最高 +20%（4000 TWS）

+ 持有房产资产：
  - 每个房产 = +15% 生存率
  - 最高 +66%（4个房产）

+ 风险调整：
  - CRITICAL: -20%
  - HIGH: -10%
  - MEDIUM: 0%
  - LOW: +5%

最终生存率 = 34% + 代币加成 + 房产加成 + 风险调整
最高生存率 = 100%
```

---

## 💰 经济模型设计

### 1. 代币经济

#### TWS代币发行

- **总量**：固定或通胀模型
- **发行方式**：用户购买（USDT → TWS）
- **价格机制**：与地缘政治风险挂钩

#### 代币价格公式

```
TWS价格 = 基础价格 × (1 + 风险溢价系数)

风险溢价系数 = 风险分数 / 100

例如：
- 风险分数 50 → 溢价 50% → 价格 1.5x
- 风险分数 80 → 溢价 80% → 价格 1.8x
```

#### 代币用途

1. **购买房产**：主要用途
2. **市场交易**：二级市场流通
3. **质押收益**：锁定代币获得收益
4. **统一后兑换**：兑换房产证

---

### 2. 房产经济

#### 房产定价

- **基础价格**：基于房产实际价值（工抵价）
- **避险溢价**：基于避险价值（位置、面积）
- **市场供需**：基于市场供需关系

#### 房产价格公式

```
房产价格 = 基础价格 × (1 + 避险溢价) × (1 + 市场溢价)

避险溢价：
- 位置偏远（商洛）→ +20%
- 位置中等（宝鸡）→ +10%
- 位置繁华（西安）→ +5%

市场溢价：
- 供不应求 → +10%
- 供需平衡 → 0%
- 供过于求 → -5%
```

#### 房产价值

1. **避险价值**：统一事件后的实际居住价值
2. **投资价值**：房产升值潜力
3. **确权价值**：链上确权，不可篡改

---

## 🔄 完整购买流程

### 流程1：买币避险

```
1. 用户进入地堡
   ↓
2. 查看当前生存率（34% - 极度危险）
   ↓
3. 点击"购买TWS代币"
   ↓
4. 选择购买数量（1000/5000/10000 TWS）
   ↓
5. 使用USDT支付
   ↓
6. 获得TWS代币
   ↓
7. 生存率提升（+5% per 1000 TWS）
   ↓
8. 代币可用于购买房产或交易
```

### 流程2：买房子避险

```
1. 用户进入市场页面
   ↓
2. 浏览可用房产资产
   ↓
3. 选择心仪房产
   ↓
4. 查看房产详情（位置、价格、避险场景）
   ↓
5. 选择支付方式（USDT 或 TWS代币）
   ↓
6. 确认购买
   ↓
7. 使用USDT或TWS支付
   ↓
8. 获得资产Token（ERC1155）
   ↓
9. 生存率提升（+15% per 房产）
   ↓
10. 可在"我的资产"中查看
```

### 流程3：组合避险（币+房子）

```
1. 用户购买TWS代币（获得流动性）
   ↓
2. 使用TWS代币购买房产（获得物理保障）
   ↓
3. 双重避险效果：
   - 代币提供流动性（可随时变现）
   - 房产提供物理保障（统一后可居住）
   ↓
4. 生存率最大化（代币加成 + 房产加成）
   ↓
5. 避险效果最佳
```

---

## 📈 避险效果量化

### 生存率计算公式

```javascript
const calculateSurvivalRate = (twsBalance, assets, riskLevel) => {
  // 基础生存率
  let rate = 34;
  
  // 代币加成（每1000 TWS = +5%，最高+20%）
  const twsBonus = Math.min((twsBalance / 1000) * 5, 20);
  rate += twsBonus;
  
  // 房产加成（每个房产 = +15%，最高+66%）
  const assetBonus = Math.min(assets.length * 15, 66);
  rate += assetBonus;
  
  // 风险调整
  const riskAdjustment = {
    'CRITICAL': -20,
    'HIGH': -10,
    'MEDIUM': 0,
    'LOW': +5
  };
  rate += riskAdjustment[riskLevel] || 0;
  
  return Math.max(0, Math.min(100, rate));
};
```

### 避险等级

| 生存率 | 避险等级 | 说明 |
|--------|---------|------|
| 0-30% | 极度危险 | 几乎没有避险措施 |
| 31-50% | 高度危险 | 避险措施不足 |
| 51-70% | 中等风险 | 有一定避险措施 |
| 71-90% | 相对安全 | 避险措施充分 |
| 91-100% | 完全安全 | 避险措施完善 |

---

## 🎮 游戏化机制

### 1. 避险进度系统

**目标**：让用户有明确的避险目标

- **阶段1**：基础避险（34% → 50%）
  - 目标：购买第一个房产或2000 TWS
  - 奖励：解锁"基础避险者"称号

- **阶段2**：中级避险（50% → 70%）
  - 目标：拥有2个房产或4000 TWS
  - 奖励：解锁"中级避险者"称号

- **阶段3**：高级避险（70% → 90%）
  - 目标：拥有3个房产或6000 TWS
  - 奖励：解锁"高级避险者"称号

- **阶段4**：完全避险（90% → 100%）
  - 目标：拥有4个房产或8000 TWS
  - 奖励：解锁"完全避险者"称号

---

### 2. 避险任务系统

**目标**：通过任务引导用户购买

- **任务1**：首次购买TWS代币
  - 奖励：+2% 生存率（一次性）
  - 引导：购买至少1000 TWS

- **任务2**：首次购买房产
  - 奖励：+3% 生存率（一次性）
  - 引导：购买第一个房产

- **任务3**：组合避险
  - 奖励：+5% 生存率（一次性）
  - 引导：同时持有代币和房产

- **任务4**：避险升级
  - 奖励：+10% 生存率（一次性）
  - 引导：生存率提升到70%以上

---

### 3. 避险排行榜

**目标**：通过竞争激励用户

- **全平台避险排行榜**：
  - 显示生存率最高的用户
  - 显示持有资产最多的用户
  - 显示持有代币最多的用户

- **好友避险排行榜**：
  - 显示好友的避险进度
  - 通过社交关系激励用户

---

## 🔐 确权机制

### 统一事件后的确权流程

```
统一事件触发
    ↓
用户持有资产Token（ERC1155）
    ↓
用户提交确权申请
    ↓
平台验证：
1. 用户身份验证
2. 资产Token验证
3. 房产真实性验证
    ↓
确权通过
    ↓
用户获得房产证（PDF）
    ↓
用户可实际居住房产
```

---

## 📱 用户界面设计

### 地堡页面优化

1. **避险仪表盘**：
   - 显示当前生存率
   - 显示避险等级
   - 显示避险进度

2. **购买入口**：
   - "购买TWS代币"按钮
   - "购买房产"按钮
   - "组合避险"推荐

3. **资产展示**：
   - TWS代币余额
   - 房产资产列表
   - 避险效果说明

---

## 🚀 实施计划

### 阶段1：买币逻辑（高优先级）

1. **后端**：
   - 创建TWS代币购买API
   - 实现代币余额查询
   - 实现代币转账功能

2. **前端**：
   - 添加"购买TWS代币"界面
   - 显示代币余额
   - 显示代币对生存率的影响

### 阶段2：买房子逻辑（高优先级）

1. **后端**：
   - 完善资产购买API
   - 实现资产确权功能
   - 实现资产转让功能

2. **前端**：
   - 优化资产购买流程
   - 添加资产详情页
   - 添加"我的资产"页面

### 阶段3：组合逻辑（中优先级）

1. **后端**：
   - 实现组合避险计算
   - 实现避险任务系统
   - 实现避险排行榜

2. **前端**：
   - 添加组合避险推荐
   - 添加任务系统界面
   - 添加排行榜界面

---

## ✅ 总结

**完整的避险逻辑**：

1. **买币避险**：
   - 代币 = 避险资产 + 流动性工具
   - 持有代币 → 提升生存率
   - 代币可用于购买房产

2. **买房子避险**：
   - 房产 = 物理避难所 + 确权凭证
   - 拥有房产 → 提升生存率
   - 统一事件后可实际居住

3. **组合避险**：
   - 代币 + 房产 = 双重避险
   - 代币提供流动性，房产提供物理保障
   - 两者结合，避险效果最大化

4. **游戏化**：
   - 避险进度系统
   - 避险任务系统
   - 避险排行榜

5. **确权机制**：
   - 统一事件后确权
   - 获得房产证
   - 可实际居住

通过这套完整的逻辑，用户可以：
- 通过买币获得流动性避险
- 通过买房子获得物理避险
- 通过组合获得最佳避险效果
- 通过游戏化获得持续激励

