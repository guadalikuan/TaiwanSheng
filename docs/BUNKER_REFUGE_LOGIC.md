# 地堡避险逻辑系统设计

## 🎯 核心逻辑

**目的**：避险（应对"统一事件"的恐惧）  
**手段**：买币（TWS代币）+ 买房子（大陆房产/地堡）

---

## 📊 避险能力计算系统

### 避险能力 = 生存率（Survival Rate）

**计算公式**：
```
生存率 = 基础生存率 + 代币避险加成 + 房产避险加成 - 风险惩罚
```

### 详细计算逻辑

#### 1. 基础生存率
```
基础生存率 = 34%
```
- 初始状态：极度危险
- 目的：营造紧迫感，驱动用户行动

#### 2. 代币避险加成（TWS Token）

**机制**：
- 持有 TWS 代币 = 流动性避险
- 代币可以随时兑换为资产或现金
- 代币价值与地缘政治风险挂钩

**计算公式**：
```
代币避险加成 = min(代币余额 / 10000, 30) * 1%
```
- 每 10,000 TWS = +1% 生存率
- 最高加成：30%
- 示例：持有 50,000 TWS = +5% 生存率

**心理作用**：
- ✅ **流动性安全感**：代币可以随时变现
- ✅ **价值保值**：代币价值与风险挂钩，风险越高，代币越值钱

#### 3. 房产避险加成（Bunker Assets）

**机制**：
- 拥有房产 = 物理避险所
- 房产位置越偏远，避险能力越强
- 房产面积越大，容纳能力越强

**计算公式**：
```
房产避险加成 = 基础加成 + 位置加成 + 面积加成

基础加成 = 房产数量 * 15%
位置加成 = sum(每个房产的位置系数 * 5%)
面积加成 = sum(每个房产的面积系数 * 3%)

位置系数：
- 商洛（深山）：1.5
- 宝鸡（工业区）：1.2
- 咸阳（近郊）：1.0
- 西安（核心）：0.8

面积系数：
- < 50㎡（单兵舱）：0.5
- 50-90㎡（避难所）：1.0
- 90-140㎡（地堡）：1.5
- > 140㎡（指挥所）：2.0
```

**示例**：
- 1个商洛地堡（120㎡）= 15% + (1.5 * 5%) + (1.5 * 3%) = 15% + 7.5% + 4.5% = 27%
- 1个西安避难所（80㎡）= 15% + (0.8 * 5%) + (1.0 * 3%) = 15% + 4% + 3% = 22%

**心理作用**：
- ✅ **物理安全感**：有地方去
- ✅ **位置优势**：偏远地区更安全
- ✅ **容量保障**：大房子可以容纳更多人

#### 4. 风险惩罚

**机制**：
- 地缘政治风险上升时，避险能力下降
- 风险越高，惩罚越大

**计算公式**：
```
风险惩罚 = 风险等级惩罚值

风险等级惩罚：
- CRITICAL（80-100分）：-20%
- HIGH（60-79分）：-10%
- MEDIUM（40-59分）：0%
- LOW（0-39分）：+5%（奖励）
```

**心理作用**：
- ✅ **紧迫感**：风险上升时，生存率下降，驱动用户购买更多资产
- ✅ **真实感**：让用户感觉"这是动态的，不是静态的游戏"

---

## 🔄 完整避险流程

### 阶段 1: 初始状态（极度危险）

```
用户进入地堡
    ↓
生存率：34%（极度危险）
    ↓
提示：警告！您的資產不足以應對事件。請立即獲取避難所。
    ↓
用户产生恐惧和紧迫感
```

### 阶段 2: 购买代币（流动性避险）

```
用户购买 TWS 代币
    ↓
代币避险加成：+5%（假设购买 50,000 TWS）
    ↓
生存率：34% + 5% = 39%（仍然危险）
    ↓
提示：代币提供流动性保障，但您仍需要物理避险所
```

### 阶段 3: 购买房产（物理避险）

```
用户购买第一个地堡（商洛，120㎡）
    ↓
房产避险加成：+27%
    ↓
生存率：34% + 5% + 27% = 66%（安全）
    ↓
提示：系統已穩定。維持資產以保持狀態。
```

### 阶段 4: 风险上升（动态调整）

```
地缘政治风险上升（CRITICAL）
    ↓
风险惩罚：-20%
    ↓
生存率：66% - 20% = 46%（危险）
    ↓
紧急通知：⚠️ 系統警報：地緣政治風險上升
    ↓
用户产生紧迫感，购买更多资产
```

### 阶段 5: 强化避险（达到100%）

```
用户购买更多代币和房产
    ↓
代币避险加成：+30%（最高）
房产避险加成：+40%（多个房产）
    ↓
生存率：34% + 30% + 40% - 20% = 84%（安全）
    ↓
继续购买，达到 100%（完全安全）
```

---

## 💰 购买激励机制

### 1. 代币购买激励

**机制**：
- 购买代币 = 立即提升生存率
- 代币可以用于购买房产
- 代币可以随时兑换

**UI 展示**：
```
TWS 代幣
餘額：50,000
生存率加成：+5%
[購買代幣] 按钮
```

**心理作用**：
- ✅ **即时反馈**：购买后立即看到生存率提升
- ✅ **流动性安全感**：代币可以随时变现

### 2. 房产购买激励

**机制**：
- 购买房产 = 大幅提升生存率
- 房产位置越偏远，加成越多
- 房产面积越大，加成越多

**UI 展示**：
```
獲取資產
+15% 基础生存率
+位置加成（商洛 +7.5%）
+面积加成（地堡 +4.5%）
总计：+27% 生存率
[前往市場] 按钮
```

**心理作用**：
- ✅ **物理安全感**：有地方去
- ✅ **位置优势**：偏远地区更安全

### 3. 组合购买激励

**机制**：
- 同时持有代币和房产 = 组合加成
- 代币可以用于购买房产
- 房产可以产生收益（租金）

**组合加成公式**：
```
组合加成 = (代币避险加成 + 房产避险加成) * 1.1
```
- 如果同时持有代币和房产，总加成提升 10%

**心理作用**：
- ✅ **协同效应**：代币和房产相互增强
- ✅ **投资价值**：房产可以产生收益

---

## 🎮 游戏化机制

### 1. 生存率等级系统

**等级划分**：
- **极度危险**（0-40%）：红色，闪烁警告
- **危险**（41-60%）：橙色，提示行动
- **安全**（61-80%）：绿色，稳定状态
- **完全安全**（81-100%）：金色，完美状态

**UI 展示**：
```
当前生存機率
[环形进度条]
84%
[安全] 标签
```

### 2. 避险任务系统

**任务类型**：
1. **购买代币任务**
   - 购买 10,000 TWS → +1% 生存率
   - 购买 50,000 TWS → +5% 生存率
   - 购买 100,000 TWS → +10% 生存率

2. **购买房产任务**
   - 购买第一个地堡 → +15% 生存率
   - 购买第二个地堡 → +15% 生存率
   - 购买深山核掩体 → +25% 生存率（特殊奖励）

3. **组合任务**
   - 同时持有 50,000 TWS 和 1 个地堡 → +5% 组合加成
   - 同时持有 100,000 TWS 和 2 个地堡 → +10% 组合加成

**心理作用**：
- ✅ **目标感**：明确的升级路径
- ✅ **成就感**：完成任务获得奖励

### 3. 避险排行榜

**排名维度**：
- 生存率排名
- 代币持有量排名
- 房产数量排名
- 组合避险能力排名

**心理作用**：
- ✅ **竞争感**：我要比别人准备得更好
- ✅ **从众心理**：看到其他人也在准备

---

## 📈 动态调整机制

### 1. 风险事件触发

**触发条件**：
- 地缘政治风险上升
- 新闻事件影响
- 预言机检测到异常

**调整逻辑**：
```
风险等级变化
    ↓
风险惩罚调整
    ↓
生存率动态下降
    ↓
紧急通知显示
    ↓
用户产生紧迫感
    ↓
购买更多资产
```

### 2. 代币价值波动

**机制**：
- 风险上升 → 代币价值上升
- 风险下降 → 代币价值下降

**心理作用**：
- ✅ **价值感知**：风险越高，代币越值钱
- ✅ **投资价值**：持有代币可以保值增值

### 3. 房产价值波动

**机制**：
- 风险上升 → 房产需求上升 → 价格上升
- 偏远地区房产更受欢迎

**心理作用**：
- ✅ **稀缺性**：房产数量有限，增加紧迫感
- ✅ **投资价值**：房产可以升值

---

## 🎯 用户行为路径

### 路径 1: 保守型用户

```
进入地堡（34%）
    ↓
购买代币（+5% → 39%）
    ↓
购买第一个地堡（+27% → 66%）
    ↓
达到安全状态，停止购买
```

### 路径 2: 积极型用户

```
进入地堡（34%）
    ↓
购买大量代币（+30% → 64%）
    ↓
购买多个地堡（+40% → 104%，达到100%上限）
    ↓
继续购买，追求完美状态
```

### 路径 3: 风险驱动型用户

```
进入地堡（34%）
    ↓
风险上升（-20% → 14%）
    ↓
紧急购买代币和房产
    ↓
快速提升生存率
    ↓
达到安全状态
```

---

## 💡 实施建议

### 1. 后端实现

**需要新增的数据**：
- 用户代币余额
- 用户房产列表
- 风险等级实时数据
- 避险能力计算逻辑

**API 端点**：
- `GET /api/bunker/refuge-capacity` - 获取避险能力详情
- `POST /api/bunker/purchase-token` - 购买代币
- `POST /api/bunker/purchase-asset` - 购买房产
- `GET /api/bunker/ranking` - 获取排行榜

### 2. 前端实现

**需要新增的 UI**：
- 避险能力详情面板
- 代币购买界面
- 房产购买界面
- 组合加成显示
- 避险排行榜

### 3. 数据可视化

**图表展示**：
- 生存率趋势图
- 代币持有量趋势
- 房产数量趋势
- 风险等级变化

---

## ✅ 总结

这套完整的避险逻辑系统通过以下机制实现"避险"目的：

1. **双重手段**：代币（流动性）+ 房产（物理）
2. **动态调整**：根据风险等级实时调整
3. **游戏化**：等级系统、任务系统、排行榜
4. **心理驱动**：恐惧驱动 + 安全感提供

**核心公式**：
```
生存率 = 34% + 代币避险加成 + 房产避险加成 - 风险惩罚
```

**目标**：
- 让用户通过购买代币和房产，不断提升生存率
- 从 34%（极度危险）→ 100%（完全安全）
- 在这个过程中，用户不断购买，平台不断获利

